/*
 * maphub-maps-core
 * (c) 2018 HERE
 */
/* -------------------------------------------------------------------------------------------- */
/*
 * rbush: Copyright (c) 2016 Vladimir Agafonkin
 */
(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.TigerMapBase = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (global){
var xyzMaps=global["HERE"]["xyz"]["maps"];xyzMaps["build"]={name:"xyz-maps",version:"0.9.13",revision:"05036fd",releaseDate:"Fri May 11 2018 12:11:29 GMT+0200 (CEST)"},xyzMaps["tile"]=xyzMaps["tile"]||{},xyzMaps["tile"]["Tile"]=require(2),xyzMaps["tile"]["Utils"]=require(3),xyzMaps["layers"]=xyzMaps["layers"]||{},xyzMaps["layers"]["TileLayer"]=require(11),xyzMaps["geo"]=xyzMaps["geo"]||{},xyzMaps["geo"]["Point"]=require(7),xyzMaps["geo"]["Rect"]=require(8),xyzMaps["pixel"]=xyzMaps["pixel"]||{},xyzMaps["pixel"]["Point"]=require(18),xyzMaps["pixel"]["Rect"]=require(19),xyzMaps["features"]=xyzMaps["features"]||{},xyzMaps["features"].Feature=require(22),xyzMaps["storage"]={Level2Storage:require(36),LRUStorage:require(35)},xyzMaps["providers"]=xyzMaps["providers"]||{ImageProvider:require(27),GeoJSONProvider:require(24),FeatureProvider:require(23),LocalProvider:require(28),RemoteTileProvider:require(29),EditableProvider:require(21),SpaceProvider:require(26)},xyzMaps["projection"]={EPSG_3857:require(20)},xyzMaps["loaders"]={TileLoader:require(16),HTTPLoader:require(13),IndexDBLoader:require(14),Manager:require(15)},xyzMaps["service"]=xyzMaps["service"]||{},xyzMaps["service"]["Geocoder"]=require(34),xyzMaps["data"]=xyzMaps["data"]||{},xyzMaps["data"]["prepare"]=xyzMaps["data"]["prepare"]||{},xyzMaps["data"]["prepare"]["GeoJSON"]=require(6),module.exports=xyzMaps;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"11":11,"13":13,"14":14,"15":15,"16":16,"18":18,"19":19,"2":2,"20":20,"21":21,"22":22,"23":23,"24":24,"26":26,"27":27,"28":28,"29":29,"3":3,"34":34,"35":35,"36":36,"6":6,"7":7,"8":8}],2:[function(require,module,exports){
function Tile(e,t,o){this.quadkey=e,LRC=UTILS.quadToGrid(e),this.level=LRC[0],this.row=LRC[1],this.col=LRC[2],this.type=t,this.expire=o;var i=UTILS.getGeoBounds(LRC[0],LRC[1],LRC[2]);this.bounds=[i[1],i[2],i[3],i[0]]}var TileUtils=require(4),rbush=require(39),Projection=require(20),TILESIZE=256,UTILS=new TileUtils(TILESIZE),NULL=null,LRC,projection=new Projection(TILESIZE);Tile.prototype={quadkey:NULL,level:NULL,row:NULL,col:NULL,type:NULL,bounds:NULL,loadStartTs:NULL,loadStopTs:NULL,errorTs:NULL,onLoaded:NULL,data:NULL,provider:NULL,screenX:NULL,screenY:NULL,canvasX:NULL,canvasY:NULL,expire:1/0},Tile.prototype.expired=function(e){return(e=e||Date.now())-this.loadStopTs>1e3*this.expire},Tile.prototype.isInVp=function(){return this.screenX!=UNDEF},Tile.prototype.add=function(e){var t=this.data;t&&-1==t.indexOf(e)&&(t.push(e),this.tree&&this.tree.insert(e))},Tile.prototype.remove=function(e){var t=this.data.indexOf(e);-1!==t&&(this.data.splice(t,1),this.tree&&this.tree.remove(e))},Tile.prototype.createTree=function(e){this.tree=rbush(9,[".bbox[0]",".bbox[1]",".bbox[2]",".bbox[3]"]),e&&this.tree.load(e)},Tile.prototype.search=function(e){if(this.tree)return this.tree.search(e)},Tile.prototype.isLoaded=function(){return"number"==typeof this.loadStopTs},Tile.prototype.cbnds=NULL,Tile.prototype.getContentBounds=function(){if(!this.cbnds){var e=this.bounds,t=this.provider.margin;if(t){var o=TILESIZE<<this.level,i=projection.lon2x(e[0],o),r=projection.lat2y(e[1],o);this.cbnds=[projection.x2lon(i-t,o),projection.y2lat(r+t,o),projection.x2lon(i+t+TILESIZE,o),projection.y2lat(r-t-TILESIZE,o)]}else this.cbnds=this.bounds}return this.cbnds},Tile.prototype.project=function(e,t){var o=TILESIZE<<this.level,i=this.col*TILESIZE,r=this.row*TILESIZE;return[Math.round(projection.lon2x(e,o)-i),Math.round(projection.lat2y(t,o)-r)]},Tile.prototype.lon2x=function(e){var t=TILESIZE<<this.level,o=this.col*TILESIZE;return Math.round(projection.lon2x(e,t)-o)},Tile.prototype.lat2y=function(e){var t=TILESIZE<<this.level,o=this.row*TILESIZE;return Math.round(projection.lat2y(e,t)-o)},module.exports=Tile;
},{"20":20,"39":39,"4":4}],3:[function(require,module,exports){
(function (global){
var Projection=require(20),projection=new Projection(256),WIN=global,MATH=WIN.Math;module.exports=function(o){o=o||projection.tileSize,this.pixelToGrid=function(o,t,e){return[e,MATH.floor(t),MATH.floor(o)]},this.geoToGrid=function(o,t,e){var r=MATH.pow(2,e),i=MATH.floor(projection.lon2x(o,r));return[e,MATH.floor(projection.lat2y(t,r)),i]},this.quadToGrid=function(o){"number"==typeof o&&(o=String(o));for(var t=o.length,e=0,r=0,i=0;i<t;++i)switch(e*=2,r*=2,o[i]){case"1":r++;break;case"3":r++;case"2":e++}return[t,e,r]},this.tileXYToQuadKey=function(o,t,e){for(var r,i="";o-- >0;)r=1<<o,i+=(0!=(e&r))+2*(0!=(t&r));return i},this.getGeoBounds=function(t,e,r){var i=o<<t,n=o*r,l=o*e;return[projection.y2lat(l,i),projection.x2lon(n,i),projection.y2lat(l+o,i),projection.x2lon(n+o,i)]},this.getTilesOfLevel=function(o,t){var e=[o],r=0,i=e.length,n=o.length;if(t<=n)return[o.substring(0,t)];for(;n<t;){for(;r<i;r++)e.push(e[r]+"0",e[r]+"1",e[r]+"2",e[r]+"3");r=i,i=e.length,n++}return e.slice(r)},this.getTilesIds=function(o,t){for(var e=[],r=t[1]-o[1]+1,i=t[2]-o[2]+1,n=0;n<r;n++)for(var l=0;l<i;l++)e[e.length]=this.tileXYToQuadKey(o[0],o[1]+n,o[2]+l);return e},this.getTilesInRect=function(o,t,e,r,i){var n=this.geoToGrid(o,r,i),l=this.geoToGrid(e,t,i);return this.getTilesIds(n,l)}};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"20":20}],4:[function(require,module,exports){
(function (global){
var Projection=require(20),projection=new Projection(256),WIN=global,MATH=WIN.Math;module.exports=function(o){o=o||projection.tileSize,this.pixelToGrid=function(o,t,e){return[e,MATH.floor(t),MATH.floor(o)]},this.geoToGrid=function(o,t,e){var r=MATH.pow(2,e),i=MATH.floor(projection.lon2x(o,r));return[e,MATH.floor(projection.lat2y(t,r)),i]},this.quadToGrid=function(o){"number"==typeof o&&(o=String(o));for(var t=o.length,e=0,r=0,i=0;i<t;++i)switch(e*=2,r*=2,o[i]){case"1":r++;break;case"3":r++;case"2":e++}return[t,e,r]},this.tileXYToQuadKey=function(o,t,e){for(var r,i="";o-- >0;)r=1<<o,i+=(0!=(e&r))+2*(0!=(t&r));return i},this.getGeoBounds=function(t,e,r){var i=o<<t,n=o*r,l=o*e;return[projection.y2lat(l,i),projection.x2lon(n,i),projection.y2lat(l+o,i),projection.x2lon(n+o,i)]},this.getTilesOfLevel=function(o,t){var e=[o],r=0,i=e.length,n=o.length;if(t<=n)return[o.substring(0,t)];for(;n<t;){for(;r<i;r++)e.push(e[r]+"0",e[r]+"1",e[r]+"2",e[r]+"3");r=i,i=e.length,n++}return e.slice(r)},this.getTilesIds=function(o,t){for(var e=[],r=t[1]-o[1]+1,i=t[2]-o[2]+1,n=0;n<r;n++)for(var l=0;l<i;l++)e[e.length]=this.tileXYToQuadKey(o[0],o[1]+n,o[2]+l);return e},this.getTilesInRect=function(o,t,e,r,i){var n=this.geoToGrid(o,r,i),l=this.geoToGrid(e,t,i);return this.getTilesIds(n,l)}};
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"20":20}],5:[function(require,module,exports){
(function (global){
var FeaturePrepare=require(6),JSU="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null,UNDEF;module.exports=JSU.extend(JSU.clone(FeaturePrepare),{prepareFeature:function(e){return e.properties=e.properties||{},e["id"]==UNDEF&&(e["id"]=JSU.String.random()),e.bbox?(6===e.bbox.length&&(e.bbox=[e.bbox[0],e.bbox[1],e.bbox[3],e.bbox[4]]),e):this.updateBBox(e)&&e}});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"6":6}],6:[function(require,module,exports){
function updatePointBBox(e,t){var o,n;t&&((o=e[0])<t[0]&&(t[0]=o),o>t[2]&&(t[2]=o),(n=e[1])<t[1]&&(t[1]=n),n>t[3]&&(t[3]=n))}function updateLineStringBBox(e,t){for(var o=e.length;o--;)updatePointBBox(e[o],t)}var UNDEF,Prepare={};Prepare.updateBBox=function(e){var t=e.geometry.type,o=!0,n=e.geometry.coordinates,r=e.bbox=[1/0,1/0,-1/0,-1/0];if("MultiLineString"==t)for(var i=0;i<n.length;i++)updateLineStringBBox(n[i],r);else if("MultiPolygon"==t)for(var a=0;a<n.length;a++)updateLineStringBBox(n[a][0],r);else"MultiPoint"==t?updateLineStringBBox(n,r):"LineString"==t?updateLineStringBBox(n,r):"Polygon"==t?updateLineStringBBox(n[0],r):"Point"==t?e.bbox=[n[0],n[1],n[0],n[1]]:o=!1;return o},Prepare.prepareFeature=function(e){return e["id"]!=UNDEF?e["id"]=e["id"]:e["id"]=1e8*Math.random()^0,e.bbox?(6===e.bbox.length&&(e.bbox=[e.bbox[0],e.bbox[1],e.bbox[3],e.bbox[4]]),e):this.updateBBox(e)&&e},module.exports=Prepare;
},{}],7:[function(require,module,exports){
function GeoPoint(t,o){this.longitude=t,this.latitude=o}GeoPoint.prototype.longitude=null,GeoPoint.prototype.latitude=null,module.exports=GeoPoint;
},{}],8:[function(require,module,exports){
function GeoRect(t,o,e,n){this.minLon=t,this.minLat=o,this.maxLon=e,this.maxLat=n}GeoRect.prototype.minLon=null,GeoRect.prototype.minLat=null,GeoRect.prototype.maxLon=null,GeoRect.prototype.maxLat=null,module.exports=GeoRect;
},{}],9:[function(require,module,exports){
module.exports={};
},{}],10:[function(require,module,exports){
function mixin(t,e){for(var r in e)t[r]=e[r];return t}function LayerStyle(t,e){var r=this;e.styleGroups=t.styleGroups||{},t["assign"]&&(r.assign=t.assign);for(var n in t)r[n]=t[n];r._c={},r._l=e}var UNDEF;LayerStyle.prototype={styleGroups:null,_c:null,assign:function(t,e){return t.geometry.type},getStyleGroup:function(t,e,r){var n=this._c[t.id];return(n==UNDEF||r)&&"object"!=typeof(n=this.assign(t,e))&&(n=this.styleGroups[n]),n},setStyleGroup:function(t,e,r){var n=t.id,i=this._c;return e&&r&&(e=this.merge(this.getStyleGroup(t),e)),e?i[n]=e:i[n]&&delete i[n],e},merge:function(t,e){if(null===e||!1===e)return null;for(var r,n=[],i=0,s=t.length;i<s;i++)r=mixin({},t[i]),e[i]&&mixin(r,e[i]),n[i]=r;return n}},module.exports=LayerStyle;
},{}],11:[function(require,module,exports){
(function (global){
function Layer(e){var t=this;for(var r in e)t[r]=e[r];t.id=t.id||"L-"+(1e8*Math.random()^0),t._l=new Listeners("add","remove","modify","clear","style","viewportReady");var o=e.providers||e.provider;if(t._p=[],o instanceof Array)for(var i,n=0;n<o.length;n++){i=o[n];for(var p=i.min;p<=i.max;p++)t._p[p]=i.provider}else for(var a=t.min;a<=t.max;a++)t._fp=t._p[a]=o,t._fp.minLevel=t.min,t._fp.maxLevel=t.max;t._p.forEach(function(e,r){"FeatureProvider"==e.__type&&(e.addEventListener("add",t._afl,t),e.addEventListener("remove",t._rfl,t),e.addEventListener("modify",t._mfl,t)),e.addEventListener("clear",t._cpl,t)}),t.setMargin(t.getMargin());var s;(s=e.style||e.styles||this._fp&&this._fp.styles||defaultStylesDef)&&t.setStyle(s),["style","styles","provider","providers"].forEach(function(e){delete t[e]})}var Listeners=("undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]:null)["Listener"],Options=require(9),defaultStylesDef=require(37),LayerStyle=require(10),UNDEF;Layer.prototype.getProvider=function(e){return e?this._p[0^e]:this._fp},Layer.prototype.addEventListener=function(e,t,r){var o=this._l;return o.isDefined(e)?o.add(e,t,r):this._fp&&this._fp.addEventListener(e,t,r)},Layer.prototype.removeEventListener=function(e,t,r){var o=this._l;return o.isDefined(e)?o.remove(e,t,r):this._fp.removeEventListener(e,t,r)},Layer.prototype._mfl=function(e,t,r,o){this._l.trigger("modify",[e,t,r,this],!0)},Layer.prototype._cpl=function(e,t){this._l.trigger("clear",[this,t],!0)},Layer.prototype._afl=function(e,t){this._l.trigger("add",[e,t,this],!0)},Layer.prototype._rfl=function(e,t){e.id;this.setStyleGroup(e),this._l.trigger("remove",[e,t,this],!0)},Layer.prototype.modifyFeatureCoordinates=function(e,t){return this._fp.modifyFeatureCoordinates(e,t)},Layer.prototype.addFeature=function(e,t){return e=this._fp.addFeature(e),t&&this.setStyleGroup(e,t),e},Layer.prototype.removeFeature=function(e){return this._fp.removeFeature(e)},Layer.prototype.name="",Layer.prototype.min=15,Layer.prototype.max=20,Layer.prototype._p=null,Layer.prototype._sd=null,Layer.prototype.setStyleGroup=function(e,t,r){this._sd&&this._l.trigger("style",[e,this._sd.setStyleGroup(e,t,r),this],!0)},Layer.prototype.getStyleGroup=function(e,t,r){return this._sd&&this._sd.getStyleGroup(e,t,r)},Layer.prototype.search=function(){if(this._fp&&this._fp.search)return this._fp.search.apply(this._fp,arguments)},Layer.prototype.getTile=function(e,t,r){var o=this,i=e.length;return t&&!t.__w&&(t.__w=function(e){t(e,o)}),o._p[i].getTile(e,t&&t.__w,r)},Layer.prototype.cancelTile=function(e,t){var r="string"==typeof e?e.length:e.quadkey.length;return this._p[r].cancel(e,t&&t.__w)},Layer.prototype.getCachedTile=function(e){var t=e.length;return this._p[t]&&this._p[t].getCachedTile(e)},Layer.prototype.setStyle=function(e){function t(e){return"function"==typeof e}t(e.getStyleGroup)&&t(e.setStyleGroup)||(e=new LayerStyle(e,this)),this._sd=e},Layer.prototype.getStyle=function(){return this._sd},Layer.prototype.getMargin=function(){return this.margin},Layer.prototype.margin=20,Layer.prototype.setMargin=function(e){e=Number(e||0);for(var t=this._p,r=t.length;r--;)t[r]&&t[r].setMargin(e);return this.margin=e},Layer.prototype.pointerEvents=function(e){return e!=UNDEF&&(this._pev=!!e),this._pev},Layer.prototype._pev=!0,Layer.prototype.__type="Layer",module.exports=Layer;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"10":10,"37":37,"9":9}],12:[function(require,module,exports){
function Geospatial(){this.earthRadius=6371e3}var TORAD=Math.PI/180,TODEG=180/Math.PI;Geospatial.prototype.movePoint=function(t,a,h,s){s=void 0===s?this.earthRadius:s;var i=a/s,M=h*TORAD,o=t[1]*TORAD,n=t[0]*TORAD,e=Math.asin(Math.sin(o)*Math.cos(i)+Math.cos(o)*Math.sin(i)*Math.cos(M)),r=n+Math.atan2(Math.sin(M)*Math.sin(i)*Math.cos(o),Math.cos(i)-Math.sin(o)*Math.sin(e));return r=(r+3*Math.PI)%(2*Math.PI)-Math.PI,[r*TODEG,e*TODEG]},Geospatial.prototype.getPointBBox=function(t,a){var h=t[1],s=t[0],i=Math.asin(a/(this.earthRadius*Math.cos(Math.PI*h/180)))*TODEG,M=Math.asin(a/this.earthRadius)*TODEG;return[s-i,h-M,s+i,h+M]},Geospatial.prototype.distance=function(t,a,h,s){var i=TORAD*(a[1]-t[1]),M=TORAD*(a[0]-t[0]),o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(TORAD*t[1])*Math.cos(TORAD*a[1])*Math.sin(M/2)*Math.sin(M/2),n=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));return this.earthRadius*n},module.exports=Geospatial;
},{}],13:[function(require,module,exports){
(function (global){
function ErrorMsg(e){var t=this;t["name"]="NetworkError",t["message"]="Service request failed with HTTP status: '"+e["status"]+" "+e["statusText"]+"'",t["statusCode"]=e["status"];var r=e["responseType"];""!=r&&"text"!=r||(t["responseText"]=e["responseText"]||null),t["XHR"]=e}var TileLoader=require(16),JSUTILS="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null,HTTPClient=require(17),DEFAULT_ACCEPT_HEADER={Accept:"application/geo+json"},UNDEF,ABCD="abcd",getX=/{([xX]|(COL))}/,getY=/{([yY]|(ROW))}/,getZ=/{([zZ]|(LEVEL))}/,getQK=/{((qk)|(QK)|(quadkey)|(QUADKEY))}/,SD_I_1_4=/{SUBDOMAIN_INT_1_4}/,SD_I=/{SUBDOMAIN_INT}/,SD_C=/{SUBDOMAIN_CHAR}/;module.exports=JSUTILS.inheritClass(TileLoader,{constructor:function(e,t,r,s){var o="json";e&&"object"==typeof e&&(s=e["headers"],r=!!e["withCredentials"],e["parser"],o=e["responseType"],e=e["src"]||e["url"]),this.withCredentials=!!r,this.baseUrl=e,this.headers=JSUTILS.extend(JSUTILS.clone(DEFAULT_ACCEPT_HEADER),s||{}),"function"==typeof e&&(this.getUrl=function(t){return e(t.level,t.row,t.col,t.quadkey)}),this.q={},this.http=new HTTPClient({responseType:o})},store:null,baseUrl:null,getUrl:function(e){var t=4*Math.random()^0;return this.baseUrl.replace(SD_I_1_4,t+1).replace(SD_I,t).replace(SD_C,ABCD[t]).replace(getQK,e.quadkey).replace(getZ,e.level).replace(getX,e.col).replace(getY,e.row)},setUrl:function(e){this.baseUrl=e},load:function(e,t,r){var s,o=this.getUrl(e),n=e.quadkey,a=this.q,l={key:n,url:o,success:t,error:r};"image"==e.type?(l.responseType="blob",l.success=function(e){a[n]=s;var r=new Image;r.onload=function(e){delete a[n],global.URL.revokeObjectURL(r.src),s._aborted||t(r)},r.src=global.URL.createObjectURL(e)}):("json"==e.type&&(l.success=function(e,r){t("FeatureCollection"==e.type?e.features:e,r)}),l.headers=this.headers),s=this.send(l)},abort:function(e){var t=this.q,r=e.quadkey,s=t[r];s&&("image"==e.type&&(s.onload=UNDEF,s._aborted=!0),s.abort&&s.abort(),delete t[r])},withCredentials:!1,headers:null,send:function(e){var t=this,r=e.key||Math.random(),s=t.q,o=e.success;e.success=function(e,t){delete s[r],o(e,t)};var n=e.error;return e.error=function(e){delete s[r],n(new ErrorMsg(e))},s[r]=this.http.send(e)}});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"16":16,"17":17}],14:[function(require,module,exports){
(function (global){
function IndexDBLoader(e){function o(e){n=!1;var o=e?indexedDB.open(dbName,r+1):indexedDB.open(dbName);o.onupgradeneeded=function(o){var t=o.target.result,n=o.target.transaction;if(r=0|t.version,console.info("onupgradeneeded",t.version),!t.objectStoreNames.contains(metaDataStore)){t.createObjectStore(metaDataStore).add(a={},"STORES")}e==UNDEF||t.objectStoreNames.contains(e)||(t.createObjectStore(e),a[e]=+new Date),n.objectStore(metaDataStore).put(a,"STORES")},o.onsuccess=function(e){function d(){n=!0;var e;for(var o in c)e=c[o],a[e[0]]?e[1]&&e[1]():e[2]&&e[2](),delete c[o]}t=o.result,t.onversionchange=function(e){t.close(),n=!1},r=0|t.version,a===UNDEF?t.transaction(metaDataStore,"readonly").objectStore(metaDataStore).get("STORES").onsuccess=function(e){a=e.target.result,d()}:d()},o.onerror=o.onblocker=function(e){}}var t,a,n,r=0,c={},d={};o();var i=this,s=e;i.baseUrl=e,i.abort=function(e){console.log("%cABORT INDEXDBLOADER "+e.quadkey,"background-color:red;color:white");var o=e.quadkey;c[o]&&delete c[o],d[o]&&(d[o].abort(),delete d[o])},i.load=function(e,o,r){function i(){var a=t.transaction(s,"readonly");d[u]=a,a.objectStore(s).get(e.quadkey).onsuccess=function(e){var t=e.target.result;delete d[u],t?o&&HERE.xyz.maps.common.parseJSONArray(t,o):r&&setTimeout(r,0)}}var u=e.quadkey;console.time("total "+e.quadkey),n?a[s]?i():(console.timeEnd("total "+e.quadkey),r&&r()):(console.log("not ready yet"),c[u]=[s,i,r])},i.clear=function(e){a[s]&&(t.transaction(s,"readwrite").objectStore(s).clear().onsuccess=e)},i.store=function(e,r){function d(){e.data?t.transaction(s,"readwrite").objectStore(s).put(JSON.stringify(e.data),e.quadkey).onsuccess=r:r()}var i=e.quadkey;a[s]?d():(c[i]=[s,d],n&&o(s))}}var utils="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null,TileLoader=require(16),UNDEF,metaDataStore="METADATA",dbName="T!GERDB";console.log("TL",TileLoader),utils.extend(IndexDBLoader.prototype,TileLoader),module.exports=IndexDBLoader;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"16":16}],15:[function(require,module,exports){
function ManagedLoader(e,a,t){for(var r=arguments,o=[],n=0;n<r.length;n++)o[n]=r[n];this.q=[],this.lq={},this.src=o}var ManagedLoaderPrototype=ManagedLoader.prototype;ManagedLoaderPrototype.executing=0,ManagedLoaderPrototype.parallel=16,ManagedLoaderPrototype.exec=function(){for(var e=this,a=e.q;a.length&&e.executing<e.parallel;)e.fire(a.pop(),a.pop(),a.pop())},ManagedLoaderPrototype.fire=function(e,a,t,r){var o=this,n=o.src,d=o.lq,r=0^r;o.executing++,d[e.quadkey]=[e,a,t,r],n[r].load(e,function(t,r){o.executing--,delete d[e.quadkey],o.exec(),a(t,r)},function(a){t(a),o.executing--,delete d[e.quadkey],o.exec()})},ManagedLoaderPrototype.tile=function(e,a,t){this.q.push(t,a,e),this.exec()},ManagedLoaderPrototype.abort=function(e){var a,t,r=this,o=r.q,n=r.lq,d=r.src,i=!0;return-1!==(a=o.indexOf(e))?o.splice(a-2,3):(t=n[e.quadkey])?(r.executing--,delete n[e.quadkey],d[t[3]].abort(e)):i=!1,r.exec(),i},ManagedLoaderPrototype.store=function(e,a){var t=this.src;for(var r in t)if(t[r].store){t[r].store(e,a);break}},ManagedLoaderPrototype.clear=function(){this.src.forEach(function(e){e.clear&&e.clear()})},ManagedLoaderPrototype.setUrl=function(){var e=this.src;for(var a in e)e[a].setUrl&&e[a].setUrl.apply(e[a],arguments)},module.exports=ManagedLoader;
},{}],16:[function(require,module,exports){
function TileLoader(){}TileLoader.prototype={load:function(o,e,t){},abort:function(o){}},module.exports=TileLoader;
},{}],17:[function(require,module,exports){
function HTTPLoader(e){for(var t in e)this[t]=e[t]}HTTPLoader.prototype={withCredentials:!1,responseType:"",send:function(e){var t=this,s=e.success,n=e.error,r=e["responseType"]||t.responseType,o=e["headers"],a=new XMLHttpRequest;if(a.withCredentials=t.withCredentials,a.responseType="json"==r?"text":r,a.onload=function(){var e,t,n=this.responseType;""==n||"text"==n?(e=this.responseText,t=e.length,"json"==r&&(e=JSON.parse(e))):(e=this.response,t=e.byteLength),200==this.status&&s(e,t)},a.onreadystatechange=function(){4==this.readyState&&(this.status<200||this.status>=300)&&(this.onload=null,0!==this.status&&n&&n(this))},a.open(e["type"]||"GET",e["url"],!0),o)for(var i in o)a.setRequestHeader(i,o[i]);return a.send(e["data"]||null),a}},module.exports=HTTPLoader;
},{}],18:[function(require,module,exports){
function PixelPoint(i,t){this.x=i,this.y=t}module.exports=PixelPoint;
},{}],19:[function(require,module,exports){
function PixelRect(t,e,i,l){this.minX=t,this.minY=e,this.maxX=i,this.maxY=l}PixelRect.prototype.minX=null,PixelRect.prototype.minY=null,PixelRect.prototype.maxX=null,PixelRect.prototype.maxY=null,module.exports=PixelRect;
},{}],20:[function(require,module,exports){
module.exports=function(t,e){var n=this;n.tileSize=e||256,n.worldSize=n.tileSize<<t,n.lon2x=function(t,e){return(t+180)/360*(e||n.worldSize)},n.lat2y=function(t,e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*(e||n.worldSize)/360},n.x2lon=function(t,e){return 360*t/(e||n.worldSize)-180},n.y2lat=function(t,e){var o=180-360*t/(e||n.worldSize);return 360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90},n.geoToPixel=function(t,e,o){return o=o||n.worldSize,{x:n.lon2x(t,o),y:n.lat2y(e,o)}},n.pixelToGeo=function(t,e){var o=e?n.tileSize<<e:n.worldSize;return{longitude:n.x2lon(t.x,o),latitude:n.y2lat(t.y,o)}}};
},{}],21:[function(require,module,exports){
(function (global){
function EditableProvider(e,t){GeoJSONProvider.call(this,e,t),this.blocked={}}var EditFeaturePrepare=require(5),GeoJSONProvider=require(24),JSU="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null,UNDEF;JSU.inheritClass(GeoJSONProvider,EditableProvider,EditFeaturePrepare),EditableProvider.prototype["getFeatures"]=function(e,t){function r(){return l=l.map(function(e){return"object"==typeof e?e:UNDEF}),1==l.length?l[0]:l}t=t||{},e instanceof Array||("object"==typeof e&&(e["remote"]&&(t["remote"]=e["remote"]),e["onload"]&&(t["onload"]=e["onload"]),e=e["ids"]||e["id"]),e=[].concat(e));var o=this,i=!0,n=t["onload"],d=t["remote"],l=GeoJSONProvider.prototype.getFeatures.call(o,e);l instanceof Array||(l=[l]);for(var a=0;a<l.length;a++)l[a]||(l[a]=e[a],i=!1);if(i||!d){var l=r();return n&&n(l),l}e=l.filter(function(e){return"object"!=typeof e}),o._requestFeatures(e,function(e){for(var t,i=e.length;i--;)t=e[i],o.addFeature(l[l.indexOf(t.id)]=t);n&&n(r())},function(e){var r=t["onerror"];r&&r(e)},t)},EditableProvider.prototype["commit"]=null,EditableProvider.prototype["getFeatureUrl"]=null,EditableProvider.prototype["getLayerUrl"]=null,EditableProvider.prototype["getTileUrl"]=null,EditableProvider.prototype.isEditable=!0;var geoToEdit={Point:"MARKER",LineString:"LINE",MultiPolygon:"AREA"};EditableProvider.prototype.getFeatureProperties=function(e){return e.properties},EditableProvider.prototype.detectFeature=function(e){return geoToEdit[e.geometry.type]},EditableProvider.prototype.isoCC=function(e,t){return!0},EditableProvider.prototype.reserveId=function(e,t){for(var r,o=e.length,i=[];o--;)r=e[o].id,"string"==typeof r&&r.length>15?i.push(e[o].id):i.push(JSU.String.random(16));setTimeout(function(){t(i.reverse())},0)},EditableProvider.prototype.blockFeature=function(e,t){var r=e.id||e,o=typeof r;"string"!=o&&"number"!=o||(t?this.blocked[r]=!0:delete this.blocked[r])},EditableProvider.prototype._insert=function(e,t){return this.blocked[e.id]?null:GeoJSONProvider.prototype._insert.call(this,e,t)},module.exports=EditableProvider;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"24":24,"5":5}],22:[function(require,module,exports){
(function (global){
function GeoJson(e,o){this.id=e.id,this.properties=e.properties,this.geometry=e.geometry,this.bbox=e.bbox,this._provider=o,this._m=0}var JSUtils="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null;GeoJson.prototype={id:null,type:"Feature",properties:null,geometry:null,bbox:null,_provider:null,_m:null,toJSON:function(){return JSUtils.clone({id:this.id,type:this.type,bbox:this.bbox,properties:this.properties,geometry:this.geometry})},getProvider:function(){return this._provider},getBBox:function(){return this._provider.decBBox(this)}},module.exports=GeoJson;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],23:[function(require,module,exports){
(function (global){
function FeatureStorageInfo(e){this.feature=e}function FeatureProvider(e,t){var r=this;Provider.call(r,e,t),this.Feature=this.Feature||GeoJsonFeature,this.IDPOOL={}}var GeoJsonFeature=require(22),Provider=require(31),GeoJSONPrepare=require(6),JSUtils="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null,TileUtils=require(3),Geospatial=require(12),geospatial=new Geospatial,tileUtils=new TileUtils,UNDEF;FeatureStorageInfo.prototype.cnt=0,JSUtils.inheritClass(Provider,FeatureProvider,GeoJSONPrepare),FeatureProvider.prototype.getTile=function(e,t){var r=this,o=r.storage,i=o.get(e);return i===UNDEF&&(o.set(i=r.createTile(e)),i.loadStartTs=i.loadStopTs=Date.now(),i.data=r.search(i.getContentBounds())),t&&t(i),i},FeatureProvider.prototype.ignore=!1,FeatureProvider.prototype._dropFeature=function(e,t,r){var o=this,i=o.IDPOOL[e.id];i&&(i[t]&&(i[t]=UNDEF,i.cnt--),o.isDroppable&&!o.isDroppable(e)||i.cnt||(o.cnt--,delete o.IDPOOL[e.id],o.tree&&o.tree.remove(e),r&&o.listeners.trigger("remove",[e,o],!0)))},FeatureProvider.prototype._removeTile=function(e,t){var r,o,i=this,a=e.quadkey;performance.now();if(r=i.dep[a]){for(var n=0;n<r.length;n++)i.storage.remove(r[n]);delete i.dep[a]}if(i.storage.remove(e),e.isLoaded()||i.loader.abort(e),o=e.data)for(var n=0;n<o.length;n++)i._dropFeature(o[n],a,t)},FeatureProvider.prototype.setFilter=function(e){this.filter="function"==typeof e?e:UNDEF},FeatureProvider.prototype.reserveTile=function(e){},FeatureProvider.prototype.cnt=0,FeatureProvider.prototype.getFeatureClass=function(e){return this.Feature},FeatureProvider.prototype.isFeatureInstance=function(e,t){return e instanceof t},FeatureProvider.prototype.createFeature=function(e,t){return new t(e,this)},FeatureProvider.prototype._insert=function(e,t){var r=e.id,o=null,i=this.getFeatureClass(e),a=this.filter;return a&&!a(e)||(this.IDPOOL[r]===UNDEF&&(this.cnt++,this.isFeatureInstance(e,i)?e._provider=this:e=this.createFeature(e,i),this.IDPOOL[r]=new FeatureStorageInfo(e),o=e),t&&this._mark(e,t)),o},FeatureProvider.prototype._mark=function(e,t){var r=this.IDPOOL[e.id];r[t.quadkey]||(r.cnt++,r[t.quadkey]=!0)},FeatureProvider.prototype.addFeature=function(e){var t,r,o,i=this;if("FeatureCollection"==e.type&&(e=e.features),o=e.length){for(var a=[],n=0;n<o;n++)a[n]=i.addFeature(e[n]);return a}if(i.isFeatureInstance(e,GeoJsonFeature)&&e._provider&&e._provider!=i&&(e=e.toJSON()),!1!==(t=i.prepareFeature(e))){if((r=i._insert(t))!=UNDEF){e=r;for(var s,u=i.getCachedTilesOfBBox(i.decBBox(e)),l=0;l<u.length;l++)s=u[l],s.add(e),s.level==i.level&&this._mark(e,s);i.tree&&i.tree.insert(e),i.ignore||i.listeners.trigger("add",[e,u],!0)}}else console.warn("unkown feature detected..",e.geometry.type),e=null;return e},FeatureProvider.prototype.all=function(){var e=this;return e.tree?e.tree.all():e._s({minX:-180,maxX:180,minY:-90,maxY:90})},FeatureProvider.prototype.getFeature=function(e){if(this.IDPOOL[e])return this.IDPOOL[e].feature},FeatureProvider.prototype.getFeatures=function(e){e instanceof Array||(e=[e]);for(var t=[],r=0;r<e.length;r++)t[r]=this.getFeature(e[r]);return 1==t.length?t[0]:t},FeatureProvider.prototype._s=function(e){if(this.tree)return this.tree.search(e);var t,r,o=1e8*Math.random()^0,i=this,a=i.level;return i.storage.forEach(function(i){if(i.level==a&&(r=i.search(e)))if(t)for(var n,s=0,u=r.length;s<u;s++)n=r[s],n._m!=o&&(n._m=o,t[t.length]=n);else{t=r;for(var s=0,u=t.length;s<u;s++)t[s]._m=o}}),t||[]},FeatureProvider.prototype.search=function(e,t){function r(e){p.splice(p.indexOf(e.quadkey),1),p.length||s&&s(a._s(i))}var o,i,a=this;if("object"==typeof e)if(t)for(var n in e)t[n]=e[n];else t=e;t=t||{};var s=t["onload"],u=t["radius"],l=t["remote"],d=(t["filter"],t["onerror"]);if(u==UNDEF&&(u=1),e instanceof Array)i=4==e.length?e:geospatial.getPointBBox(e,u);else{if("number"==typeof e||"string"==typeof e||!e)return a.getFeatures(e,t);if(e["longitude"]!=UNDEF&&e["latitude"]!=UNDEF)i=geospatial.getPointBBox([e["longitude"],e["latitude"]],u);else if(e["minLon"]!=UNDEF&&e["minLat"]!=UNDEF&&e["maxLon"]!=UNDEF&&e["maxLat"]!=UNDEF)i=[e["minLon"],e["minLat"],e["maxLon"],e["maxLat"]];else{if(o=e["point"]||e["rect"]||e["viewport"])return a.search(o,t);if(e["id"]||e["ids"])return a.getFeatures(e["id"]||e["ids"],t)}}if(i={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]},l){for(var p=tileUtils.getTilesInRect(i.minX,i.minY,i.maxX,i.maxY,a.level),f=0;f<p.length;f++){var v=p[f];a.getCachedTile(v)?p.splice(f--,1):a.getTile(v,r,d)}if(p.length)return}var c=a._s(i);return s&&s(c),c},FeatureProvider.prototype.exists=function(e){return this.IDPOOL[e.id]},FeatureProvider.prototype.modifyFeatureCoordinates=function(e,t){var r=e;if(e=this.getFeature(e.id)){var o=e.getBBox(),i=e.geometry.coordinates;this.ignore=!0,this.removeFeature(e),e.geometry.coordinates=this.encCoord(e.geometry.type,t),e.bbox=null,this.addFeature(e),this.ignore=!1,this.listeners.trigger("modify",[e,o,i,this],!0)}else r.geometry.coordinates=t,this.updateBBox(r)},FeatureProvider.prototype.removeFeature=function(e){if(e=this.getFeature(e.id)){for(var t,r=this.getCachedTilesOfBBox(this.decBBox(e)),o=0;o<r.length;o++)t=r[o],t.isLoaded()&&t.remove(e);this.cnt--,delete this.IDPOOL[e.id],this.tree&&this.tree.remove(e),this.ignore||this.listeners.trigger("remove",[e,r],!0)}return e},FeatureProvider.prototype.clear=function(e){var t,r=this,o=null;if(4==arguments.length&&(e=Array.prototype.slice.call(arguments)),e instanceof Array){o=r.getCachedTilesOfBBox(e,r.level);for(var i,a=0;a<o.length;a++)i=o[a],r._removeTile(i,!1),o[a]=i.quadkey}else if(0==arguments.length){var n={},s=r.IDPOOL,u=0;if(r.tree&&r.tree.clear(),r.isDroppable)for(var l in s)t=r.getFeature(l),r.isDroppable(t)||(n[l]=new FeatureStorageInfo(t),u++,r.tree&&r.tree.insert(t));r.cnt=u,r.dep={},r.IDPOOL=n,Provider.prototype.clear.call(this,e)}r.listeners.trigger("clear",[this,o],!0)},FeatureProvider.prototype.__type="FeatureProvider",FeatureProvider.prototype.encCoord=function(e,t){return t},FeatureProvider.prototype.decCoord=function(e){return e.geometry.coordinates},FeatureProvider.prototype.decBBox=function(e){return e.bbox},module.exports=FeatureProvider;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"12":12,"22":22,"3":3,"31":31,"6":6}],24:[function(require,module,exports){
(function (global){
function createTileReceiver(e,o,r){function t(t){if(1!==r.length&&(o.data=o.data.concat(t.data)),0==--i){1===r.length&&(o.processedData=UNDEF,o.data=e.search(o.getContentBounds())),o.loadStopTs=TIMESTAMP();for(var l in n)n[l](o);n={}}}var i=r.length,n={};return t.add=function(e,o){"function"==typeof e&&(n[o]=e)},t}function JSONProvider(e,o){e.level=e.level||13,RemoteTileProvider.call(this,e,o),this.tree=rbush(9,[".bbox[0]",".bbox[1]",".bbox[2]",".bbox[3]"])}var RemoteTileProvider=require(29),UTILS="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null,rbush=require(39),UNDEF;UTILS.inheritClass(RemoteTileProvider,JSONProvider);var TIMESTAMP=Date.now;JSONProvider.prototype.delete=function(e){this.tree.remove(e)},module.exports=JSONProvider;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"29":29,"39":39}],25:[function(require,module,exports){
var SpaceProviderOptions={environment:"prd",space:"",credentials:{},withCredentials:!1,tags:!1,https:!0,clip:!1,url:null,headers:null};module.exports=SpaceProviderOptions;
},{}],26:[function(require,module,exports){
(function (global){
function SpaceProvider(e,r){var t=this;e=JSU.extend(JSU.clone(SpaceProviderOptions),e),GeoJSONProvider.call(t,e,r),this.tags=e["tags"],this.space=e["space"],this.credentials=e["credentials"],this.url=e["url"]||ENDPOINT[e["environment"]],e["https"]&&(this.url=this.url.replace(HTTP,"https://")),this.setUrl(this.getTileUrl(this.space))}var GeoJSONProvider=require(21),Feature=require(22),JSU="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null,SpaceProviderOptions=require(25),HTTP="http://",ENDPOINT={prd:HTTP+"xyz.api.here.com/hub/spaces",cit:HTTP+"xyz.cit.api.here.com/hub/spaces",sit:HTTP+"xyz.sit.cpdev.aws.in.here.com/hub/spaces"};JSU.inheritClass(GeoJSONProvider,SpaceProvider),SpaceProvider.prototype["commit"]=function(e,r,t){function i(e){--l||r(e)}function s(e){c++,t(e)}var o=this,a=o.loader.src,n=a[a.length-1],p=o._addUrlCredentials(o.getLayerUrl(o.space)+"/features","?");if(e){var l=0,c=0,d=function(e){e instanceof Array||(e=[e]);for(var r,t,i=e.length;i--;)r=e[i]=Feature.prototype.toJSON.call(e[i]),(t=r.properties)&&delete t["@ns:com:here:editor"];return e}(e.put||[]);d.length&&(l++,n.send({url:p,success:i,error:s,type:"POST",headers:{"Content-Type":"application/geo+json"},data:JSON.stringify({type:"FeatureCollection",features:d})}));var u=e.remove||[];u.length&&(l++,n.send({url:p+"&id="+u.map(function(e){return e.id}).join(","),success:i,error:s,type:"DELETE"}))}},SpaceProvider.prototype["setMargin"]=function(e){this.margin=e,this.setUrl(this.getTileUrl(this.space))},SpaceProvider.prototype["getLayerUrl"]=function(e){return this.url+"/"+e},SpaceProvider.prototype["setUrl"]=function(e){this.loader.setUrl(this._addUrlCredentials(e))},SpaceProvider.prototype["getTileUrl"]=function(e){return this._addUrlTags(this.getLayerUrl(e)+"/tile/quadkey/{QUADKEY}?margin="+this.margin+"&clip="+!!this.clip)},SpaceProvider.prototype["setTags"]=function(e){"string"==typeof e&&(e=[e]),this.tags=e,this.setUrl(this.getTileUrl(this.space)),this.clear()},SpaceProvider.prototype["getFeatureUrl"]=function(e,r,t){return"number"==typeof r&&(r=[r]),this.getLayerUrl(e)+"/features?id="+r.join("&id=")},SpaceProvider.prototype._requestFeatures=function(e,r,t,i){var s=this.loader.src;s[s.length-1].send({key:e.join("&"),url:this._addUrlCredentials(this.getFeatureUrl(this.space,e,i)),success:r,error:t})},SpaceProvider.prototype._addUrlCredentials=function(e,r){r=r||"&";var t=this.credentials;for(var i in t)e+=r+i+"="+t[i],r="&";var s=this.headers;return s&&(e+=r+"headers="+encodeURIComponent(JSON.stringify(s))),e},SpaceProvider.prototype._addUrlTags=function(e,r){var r=r||this.tags;if(r)for(var t=r.length;t--;)e+="&tags="+r[t];return e},module.exports=SpaceProvider;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"21":21,"22":22,"25":25}],27:[function(require,module,exports){
(function (global){
function TIMESTAMP(){return+new Date}function TileProvider(e,r){var o=this;Provider.call(o,e,{storage:new LRUStorage(512)}),o.loader||(o.loader=new GenericLoader(new HTTPLoader(e["url"]))),o.renderer=e.renderer,o.name=e.name||"",o.opacity=e.opacity||1}var Provider=require(31),JSUtils="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null,Tile=require(2),LRUStorage=require(35),GenericLoader=require(15),HTTPLoader=require(13),UNDEF;JSUtils.inheritClass(Provider,TileProvider);var TileProviderPrototype=TileProvider.prototype;TileProviderPrototype.getTile=function(e,r,o,t){var i,a=this,l=a.loader,d=a.storage;return(i=d.get(e))===UNDEF&&(d.set(i=a.createTile(e)),i.onLoaded={}),i.loadStopTs?(r&&r(i),i):(r&&(i.onLoaded[t||Math.random()]=r),i.loadStartTs||(i.loadStartTs=TIMESTAMP(),l.tile(i,function(e){i.loadStopTs=TIMESTAMP(),i.data=e;var r=i.onLoaded;for(var o in r)r[o](i);i.onLoaded=UNDEF},function(){i.loadStopTs=TIMESTAMP(),i.errorTs=TIMESTAMP()})),i)},TileProviderPrototype._removeTile=function(e){e.isLoaded()||(this.storage.remove(e),this.loader.abort(e))},TileProviderPrototype.getLoader=function(){return this.loader},TileProviderPrototype.clear=function(e){var r=this,o=null;if(e instanceof Array){o=r.getCachedTilesOfBBox(e,r.level);for(var t,i=0;i<o.length;i++)t=o[i],r.storage.remove(t),o[i]=t.quadkey}else 0==arguments.length&&this.storage.clear();r.listeners.trigger("clear",[r,o],!0)},TileProviderPrototype.reset=function(){this.storage.resetData()},TileProviderPrototype.cancel=function(e){var r;(r=e instanceof Tile?e:this.storage.get(e))&&this._removeTile(r)},TileProviderPrototype.__type="ImageProvider",module.exports=TileProvider;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"13":13,"15":15,"2":2,"31":31,"35":35}],28:[function(require,module,exports){
(function (global){
function Overlay(e){var r=this;FeatureTileProvider.call(r,{minLevel:8,maxLevel:20,storage:new LRUStorage(512)},e),r.tree=rbush(9,[".bbox[0]",".bbox[1]",".bbox[2]",".bbox[3]"]),r.level=UNDEF,r.cancel=function(e){}}var FeatureTileProvider=require(23),LRUStorage=require(35),rbush=require(39),UTILS="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null,UNDEF;UTILS.inheritClass(FeatureTileProvider,Overlay),Overlay.prototype.delete=function(e){this.tree.remove(e)},Overlay.prototype.import=function(e){var r=this;r.tree.fromJSON(e),e=r.tree.all();for(var o=e.length;o--;)r._insert(e[o])},Overlay.prototype.isDroppable=function(){return!0},module.exports=Overlay;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"23":23,"35":35,"39":39}],29:[function(require,module,exports){
(function (global){
function RemoteTileProvider(e,r){var o=this,t=e.loader;t?t instanceof LoaderManager||(t=new LoaderManager(t)):t=new LoaderManager(new HTTPLoader(e["url"],e["parser"]||DEFAULT_JSON_PARSER,e["withCredentials"],e["headers"])),e.loader=t,FeatureProvider.call(o,{minLevel:8,maxLevel:20},e),o.navigable=!!e.navigable,o.opacity=e.opacity||1,o.renderer=e.renderer,o.name=e.name||"",o.sizeKB=0,"function"==typeof r&&(o._pp=r)}var UTILS="undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]["JSUtils"]:null,TileUtils=require(3),FeatureProvider=require(23),HTTPLoader=require(13),LoaderManager=require(15),TileReceiver=require(33),options=require(30),DEFAULT_JSON_PARSER="native",UNDEF,utils=new TileUtils;UTILS.inheritClass(FeatureProvider,RemoteTileProvider),RemoteTileProvider.prototype.cancel=function(e,r){var o,t,a=this,i=a.storage,n=r==UNDEF;if(t=e instanceof this.Tile?e:i.get(e)){e=t.quadkey,o=this.calcStorageQuads(e);for(var l,d,s=0;s<o.length;s++)if(d=o[s],l=d==e?t:i.get(d)){var p,c=l.onLoaded;c&&(n?t.onLoaded.length=0:a.level&&t.level!=a.level?-1!=(p=c.indexOf(t.onLoaded[0]))&&(c[p].remove(r)||c.splice(p,1)):c.splice(c.indexOf(r),1),c.length||a.loader.abort(l)&&i.remove(l))}}},RemoteTileProvider.prototype.getLoader=function(){return this.loader},RemoteTileProvider.prototype.config=function(e){return e&&e.url&&this.loader.setUrl(e.url),FeatureProvider.prototype.config.call(this,e)},RemoteTileProvider.prototype.clear=function(e){0==arguments.length&&this.loader.clear(),FeatureProvider.prototype.clear.apply(this,arguments)},RemoteTileProvider.prototype.reset=function(e){this.storage.resetData(e)},RemoteTileProvider.prototype.calcStorageQuads=function(e){return utils.getTilesOfLevel(e,this.level)},RemoteTileProvider.prototype.preprocess=function(e,r,o){var t,a=this,i=a._pp;(t="function"==typeof i?i({data:r,quadkey:e.quadkey,x:e.col,y:e.row,z:e.level,provider:a,ready:o}):r)&&o(t)},RemoteTileProvider.prototype.staticData=!1,RemoteTileProvider.prototype.getTile=function(e,r,o){var t,a=this,i=a.storage,n=a.level;if((t=i.get(e))==UNDEF)t=a.createTile(e),t.onLoaded=[],i.set(t);else if(t.isLoaded())return r&&r(t),t;if(e.length!=n){var l,d,s=a.calcStorageQuads(e);t.loadStartTs=Date.now(),t.data=[],t.onLoaded.length?d=t.onLoaded[0]:(d=new TileReceiver(a,t,s),t.onLoaded.push(d)),d.add(r);for(var p=0;p<s.length;p++)l=i.get(s[p]),l==UNDEF?l=a.getTile(s[p],d,o):l.isLoaded()?d.receive(l):-1==l.onLoaded.indexOf(d)&&l.onLoaded.push(d)}else r&&-1==t.onLoaded.indexOf(r)&&t.onLoaded.push(r),t.loadStartTs||(t.loadStartTs=Date.now(),a.loader.tile(t,function(e,r){function o(e){for(var r,o,i,n=e.length,l=[],d=0;d<n;d++)o=a.prepareFeature(r=e[d]),!1!==o?(r=o,i=a._insert(r,t),i?(r=i,l[l.length]=r):a.tree||(l[l.length]=a.getFeature(r.id))):(console.warn("unkown feature detected..",r.geometry.type,r),e.splice(d--,1),n--);if(e=l,t.loadStopTs=Date.now(),a.tree?a.tree.load(e):t.createTree(e),a.staticData?t.data=e:t.data=a.search(t.getContentBounds()),a.margin)for(var s=0,p=t.data.length;s<p;s++)a._mark(t.data[s],t);var c,u=t.onLoaded;if(u){for(var d=0,p=u.length;d<p;d++)c=u[d],c instanceof TileReceiver?c.receive(t):c(t);u.length=0}}a.sizeKB+=r/1024,a.preprocess(t,e,o)},function(e){t.loadStopTs=t.errorTs=Date.now(),o&&o(e),a.listeners.trigger("error",[e],!0)}));return t},module.exports=RemoteTileProvider;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"13":13,"15":15,"23":23,"3":3,"30":30,"33":33}],30:[function(require,module,exports){

},{}],31:[function(require,module,exports){
(function (global){
function intersectBBox(e,t,r,o,i,n,s,l){return e<=n&&i<=t&&r<=l&&s<=o}var Tile=require(2),TileStorage=require(36),TileUtils=require(3),Listeners=("undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]:null)["Listener"],options=require(32),TILESIZE=256,tileUtils=new TileUtils(TILESIZE),DEFAULT_EXPIRE_SECONDS=1/0,UNDEF,ProviderPrototype=function(e,t){var r=this;e=e||{};for(var o in t)e[o]=t[o];for(var o in e)this[o]=e[o];this.id==UNDEF&&(this.id="TP-"+(1e6*Math.random()^0)),r.storage=e.storage||new TileStorage(r.level),r.storage.onDrop(r._removeTile.bind(r),r),e.Tile&&(this.Tile=config.Tile),this.dep={},this.listeners=new Listeners("add","remove","modify","clear","error"),this.addEventListener=this.listeners.add,this.removeEventListener=this.listeners.remove};ProviderPrototype.prototype.Tile=Tile,ProviderPrototype.prototype.size=TILESIZE,ProviderPrototype.prototype.clear=function(){this.storage.clear()},ProviderPrototype.prototype.getCachedTile=function(e){return this.storage.get(e)},ProviderPrototype.prototype.setMargin=function(e){this.margin=Number(e),this.storage.forEach(function(e){this.cbnds=null})},ProviderPrototype.prototype.margin=0,ProviderPrototype.prototype.getCachedTilesOfBBox=function(e,t){var r=e[0],o=e[1],i=e[2],n=e[3],s=[];return t^=0,this.storage.forEach(function(e){var l=e.getContentBounds();!intersectBBox(l[0],l[2],l[1],l[3],r,i,o,n)||t&&e.level!=t||(s[s.length]=e)}),s},ProviderPrototype.prototype.config=function(e){e=e||{};for(var t in e)this.config[t]=e[t];return this},ProviderPrototype.prototype.createTile=function(e){var t,r,o=new this.Tile(e,"ImageProvider"==this.__type?"image":"json",this.expire||DEFAULT_EXPIRE_SECONDS),i=o.level,n=this.level;if(o.provider=this,n&&i!=n)if(i>n)t=e.substr(0,n),r=this.dep[t],r||(r=this.dep[t]=[]),r[r.length]=o;else if(i<n)for(var s=tileUtils.getTilesOfLevel(e,n),l=0,p=s.length;l<p;l++)t=s[l],r=this.dep[t],r||(r=this.dep[t]=[]),r[r.length]=o;return o},ProviderPrototype.prototype.__type="Provider",module.exports=ProviderPrototype;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"2":2,"3":3,"32":32,"36":36}],32:[function(require,module,exports){
arguments[4][30][0].apply(exports,arguments)
},{"30":30}],33:[function(require,module,exports){
function TileReceiver(e,t,i){this.cbs=[],this.qks=i,this.tile=t,this.c=0}var UNDEF;TileReceiver.prototype.ready=!1,TileReceiver.prototype.receive=function(e){var t=this;if(!t.ready){var i=t.tile,r=t.qks,o=r.indexOf(e.quadkey);-1!=o&&(r[o]=null,++t.c==r.length&&(t.ready=!0,i.processedData=UNDEF,i.data=i.provider.search(i.getContentBounds()),i.loadStopTs=Date.now(),t.exec(),i.onLoaded.length=0,t.qks=null))}},TileReceiver.prototype.exec=function(){for(var e=this,t=e.cbs,i=t.length,r=0;r<i;)t[r++](e.tile);t.length=0},TileReceiver.prototype.add=function(e){var t=this.cbs;if("function"==typeof e&&-1==t.indexOf(e))return t.push(e),!0},TileReceiver.prototype.remove=function(e){var t=this.cbs,i=t.indexOf(e);return-1!=i&&t.splice(i,1),t.length},module.exports=TileReceiver;
},{}],34:[function(require,module,exports){
function GeoCoder(e){e=e||{},e["host"]=e["host"]||"geocoder.api.here.com",e["version"]=e["version"]||"6.2",this.url="https://"+e["host"]+"/"+e["version"]+"/geocode.json",this.reverseUrl="https://reverse."+e["host"]+"/"+e["version"]+"/reversegeocode.json",this.cfg=e}function createXHR(e,o,t){var r=new XMLHttpRequest;return r.onload=function(){o(JSON.parse(this.responseText))},r.onreadystatechange=function(){var e=this.status;4==this.readyState&&(e<200||e>=300)&&0!==e&&t&&t(this)},r.open("GET",e,!0),r.send(),r}GeoCoder.prototype.createUrl=function(e,o){var t="";o=o||{};for(var r in o)t+="&"+r+"="+encodeURIComponent(o[r]);return this.reverseUrl+"?app_id="+this.cfg["app_id"]+"&app_code="+this.cfg["app_code"]+t},GeoCoder.prototype.geocode=function(e,o,t){createXHR(this.createUrl(this.url,e),o,t)},GeoCoder.prototype.reverseGeocode=function(e,o,t){createXHR(this.createUrl(this.reverseUrl,e),o,t)},GeoCoder.prototype.getIsoCountryCode=function(e,o,t){var r={mode:"retrieveAddresses",maxresults:1,jsonattributes:1};e instanceof Array?r["prox"]=e[1]+","+e[0]:r["prox"]=e["latitude"]+","+e["longitude"],this.reverseGeocode(r,function(e){var t=null;try{t=e["response"]["view"][0]["result"][0]["location"]["address"]["country"]}catch(e){}o&&o(t,e)},t)},module.exports=GeoCoder;
},{}],35:[function(require,module,exports){
(function (global){
var LRU=("undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]:null)["LRU"],TileStorage=function(o){this.cache=new LRU(o||256),this._onDrop={}};TileStorage.prototype.forEach=function(o){this.cache.forEach(o)},TileStorage.prototype.clear=function(){this.cache.clear()},TileStorage.prototype.remove=function(o){this.cache.remove(o.quadkey)},TileStorage.prototype.get=function(o){return this.cache.get(o)},TileStorage.prototype.set=function(o){var e=this.cache.set(o.quadkey,o),t=this._onDrop;e&&t&&(t=t[e.provider.id])&&t(e)},TileStorage.prototype.onDrop=function(o,e){this._onDrop[e.id]=o},module.exports=TileStorage;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],36:[function(require,module,exports){
(function (global){
function Tile2LevelStorage(e,t,o){this.lvl=e,this.main="object"==typeof t?t:new LRU(t||DEFAULT_CACHE_SIZE_MAIN),this.sub="object"==typeof o?o:new LRU(t||DEFAULT_CACHE_SIZE_SUB),this.main._onDrop=this.main._onDrop||{},this._onDrop=this.main._onDrop}var LRU=("undefined"!=typeof window?window["HERE"]["xyz"]["maps"]["common"]:"undefined"!=typeof global?global["HERE"]["xyz"]["maps"]["common"]:null)["LRU"],DEFAULT_CACHE_SIZE_MAIN=256,DEFAULT_CACHE_SIZE_SUB=1024;Tile2LevelStorage.prototype.onDrop=function(e,t){this._onDrop[t.id]=e},Tile2LevelStorage.prototype.forEach=function(e){this.main.forEach(e),this.sub.forEach(e)},Tile2LevelStorage.prototype.clear=function(){this.main.clear(),this.sub.clear()},Tile2LevelStorage.prototype.getCache=function(e){return e==this.lvl?this.main:this.sub},Tile2LevelStorage.prototype.remove=function(e){this.getCache(e.level).remove(e.quadkey)},Tile2LevelStorage.prototype.get=function(e){return this.getCache(e.length).get(e)},Tile2LevelStorage.prototype.set=function(e){var t=this.getCache(e.level),o=t.set(e.quadkey,e),i=this._onDrop;o&&i&&(i=i[o.provider.id])&&i(o)},module.exports=Tile2LevelStorage;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],37:[function(require,module,exports){
var POINT=[{zIndex:0,type:"Circle",radius:6,fill:"#ff0000"}],LINESTRING=[{zIndex:0,type:"Line",strokeWidth:10,stroke:"#ff0000"}],POLYGON=[{zIndex:0,type:"Polygon",strokeWidth:1,stroke:"#ffffff",fill:"#ff0000"}];module.exports={styleGroups:{Point:POINT,MultiPoint:POINT,LineString:LINESTRING,MultiLineString:LINESTRING,Polygon:POLYGON,MultiPolygon:POLYGON},assign:function(t){return t.geometry.type}};
},{}],38:[function(require,module,exports){
!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):t.quickselect=o()}(this,function(){"use strict";function t(t,e,f,r,i){o(t,e,f||0,r||t.length-1,i||n)}function o(t,n,f,r,i){for(;r>f;){if(r-f>600){var u=r-f+1,a=n-f+1,c=Math.log(u),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(u-h)/u)*(a-u/2<0?-1:1);o(t,n,Math.max(f,Math.floor(n-a*h/u+d)),Math.min(r,Math.floor(n+(u-a)*h/u+d)),i)}var l=t[n],s=f,M=r;for(e(t,f,n),i(t[r],l)>0&&e(t,f,r);s<M;){for(e(t,s,M),s++,M--;i(t[s],l)<0;)s++;for(;i(t[M],l)>0;)M--}0===i(t[f],l)?e(t,f,M):(M++,e(t,M,r)),M<=n&&(f=M+1),n<=M&&(r=M-1)}}function e(t,o,e){var n=t[o];t[o]=t[e],t[e]=n}function n(t,o){return t<o?-1:t>o?1:0}return t});
},{}],39:[function(require,module,exports){
"use strict";function rbush(t,i){if(!(this instanceof rbush))return new rbush(t,i);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&this._initFormat(i),this.clear()}function findItem(t,i,n){if(!n)return i.indexOf(t);for(var e=0;e<i.length;e++)if(n(t,i[e]))return e;return-1}function calcBBox(t,i){distBBox(t,0,t.children.length,i,t)}function distBBox(t,i,n,e,r){r||(r=createNode(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var a,h=i;h<n;h++)a=t.children[h],extend(r,t.leaf?e(a):a);return r}function extend(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function compareNodeMinX(t,i){return t.minX-i.minX}function compareNodeMinY(t,i){return t.minY-i.minY}function bboxArea(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function bboxMargin(t){return t.maxX-t.minX+(t.maxY-t.minY)}function enlargedArea(t,i){return(Math.max(i.maxX,t.maxX)-Math.min(i.minX,t.minX))*(Math.max(i.maxY,t.maxY)-Math.min(i.minY,t.minY))}function intersectionArea(t,i){var n=Math.max(t.minX,i.minX),e=Math.max(t.minY,i.minY),r=Math.min(t.maxX,i.maxX),a=Math.min(t.maxY,i.maxY);return Math.max(0,r-n)*Math.max(0,a-e)}function contains(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function intersects(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function createNode(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(t,i,n,e,r){for(var a,h=[i,n];h.length;)n=h.pop(),i=h.pop(),n-i<=e||(a=i+Math.ceil((n-i)/e/2)*e,quickselect(t,a,i,n,r),h.push(i,a,a,n))}module.exports=rbush,module.exports.default=rbush;var quickselect=require(38);rbush.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,n=[],e=this.toBBox;if(!intersects(t,i))return n;for(var r,a,h,o,s=[];i;){for(r=0,a=i.children.length;r<a;r++)h=i.children[r],o=i.leaf?e(h):h,intersects(t,o)&&(i.leaf?n.push(h):contains(t,o)?this._all(h,n):s.push(h));i=s.pop()}return n},collides:function(t){var i=this.data,n=this.toBBox;if(!intersects(t,i))return!1;for(var e,r,a,h,o=[];i;){for(e=0,r=i.children.length;e<r;e++)if(a=i.children[e],h=i.leaf?n(a):a,intersects(t,h)){if(i.leaf||contains(t,h))return!0;o.push(a)}i=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,n=t.length;i<n;i++)this.insert(t[i]);return this}var e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){var r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=createNode([]),this},remove:function(t,i){if(!t)return this;for(var n,e,r,a,h=this.data,o=this.toBBox(t),s=[],c=[];h||s.length;){if(h||(h=s.pop(),e=s[s.length-1],n=c.pop(),a=!0),h.leaf&&-1!==(r=findItem(t,h.children,i)))return h.children.splice(r,1),s.push(h),this._condense(s),this;a||h.leaf||!contains(h,o)?e?(n++,h=e.children[n],a=!1):h=null:(s.push(h),c.push(n),n=0,e=h,h=h.children[0])}return this},toBBox:function(t){return t},compareMinX:compareNodeMinX,compareMinY:compareNodeMinY,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},_build:function(t,i,n,e){var r,a=n-i+1,h=this._maxEntries;if(a<=h)return r=createNode(t.slice(i,n+1)),calcBBox(r,this.toBBox),r;e||(e=Math.ceil(Math.log(a)/Math.log(h)),h=Math.ceil(a/Math.pow(h,e-1))),r=createNode([]),r.leaf=!1,r.height=e;var o,s,c,l,u=Math.ceil(a/h),m=u*Math.ceil(Math.sqrt(h));for(multiSelect(t,i,n,m,this.compareMinX),o=i;o<=n;o+=m)for(c=Math.min(o+m-1,n),multiSelect(t,o,c,u,this.compareMinY),s=o;s<=c;s+=u)l=Math.min(s+u-1,c),r.children.push(this._build(t,s,l,e-1));return calcBBox(r,this.toBBox),r},_chooseSubtree:function(t,i,n,e){for(var r,a,h,o,s,c,l,u;;){if(e.push(i),i.leaf||e.length-1===n)break;for(l=u=1/0,r=0,a=i.children.length;r<a;r++)h=i.children[r],s=bboxArea(h),c=enlargedArea(t,h)-s,c<u?(u=c,l=s<l?s:l,o=h):c===u&&s<l&&(l=s,o=h);i=o||i.children[0]}return i},_insert:function(t,i,n){var e=this.toBBox,r=n?t:e(t),a=[],h=this._chooseSubtree(r,this.data,i,a);for(h.children.push(t),extend(h,r);i>=0&&a[i].children.length>this._maxEntries;)this._split(a,i),i--;this._adjustParentBBoxes(r,a,i)},_split:function(t,i){var n=t[i],e=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,e);var a=this._chooseSplitIndex(n,r,e),h=createNode(n.children.splice(a,n.children.length-a));h.height=n.height,h.leaf=n.leaf,calcBBox(n,this.toBBox),calcBBox(h,this.toBBox),i?t[i-1].children.push(h):this._splitRoot(n,h)},_splitRoot:function(t,i){this.data=createNode([t,i]),this.data.height=t.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,n){var e,r,a,h,o,s,c,l;for(s=c=1/0,e=i;e<=n-i;e++)r=distBBox(t,0,e,this.toBBox),a=distBBox(t,e,n,this.toBBox),h=intersectionArea(r,a),o=bboxArea(r)+bboxArea(a),h<s?(s=h,l=e,c=o<c?o:c):h===s&&o<c&&(c=o,l=e);return l},_chooseSplitAxis:function(t,i,n){var e=t.leaf?this.compareMinX:compareNodeMinX,r=t.leaf?this.compareMinY:compareNodeMinY;this._allDistMargin(t,i,n,e)<this._allDistMargin(t,i,n,r)&&t.children.sort(e)},_allDistMargin:function(t,i,n,e){t.children.sort(e);var r,a,h=this.toBBox,o=distBBox(t,0,i,h),s=distBBox(t,n-i,n,h),c=bboxMargin(o)+bboxMargin(s);for(r=i;r<n-i;r++)a=t.children[r],extend(o,t.leaf?h(a):a),c+=bboxMargin(o);for(r=n-i-1;r>=i;r--)a=t.children[r],extend(s,t.leaf?h(a):a),c+=bboxMargin(s);return c},_adjustParentBBoxes:function(t,i,n){for(var e=n;e>=0;e--)extend(i[e],t)},_condense:function(t){for(var i,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(i=t[n-1].children,i.splice(i.indexOf(t[n]),1)):this.clear():calcBBox(t[n],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};
},{"38":38}]},{},[1])(1)
});